---
title: "DATA607 Project 2 Dataset 3"
author: "Alexander Simon"
date: "2024-03-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
library(nycgeo)
library(sf)
library(tidyverse)

kbl_display <- function(df, box_width, box_height = NULL) {
# This function uses the kableExtra package to display a dataframe (df).
# In an HTML document, if the table exceeds the specified dimensions it will be shown in a scrollable box.
#
# Arguments:
# box_width <chr>: Width of scroll box, in pixels (eg, "200 px") or percentage of total screen width (eg, "100%")
# box_height <chr>: [Optional] Height of scroll box, in pixels or percentage
  
  if (!is.null(box_height)) {
    df %>%
      kbl() %>%
      kable_material() %>%
      scroll_box(width = box_width, height = box_height)
  } else {
    df %>%
      kbl() %>%
      kable_material() %>%
      scroll_box(width = box_width)
  }
}
```

<br>

## 0. Packages

I used the [kableExtra](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html) package to create tables and the [sf](https://r-spatial.github.io/sf/index.html) and [nycgeo](https://nycgeo.mattherman.info/) packages to create maps. If needed, you can install them using the commands below.

```{r install-packages, eval=FALSE}
install.packages("kableExtra")
install.packages("sf")
remotes::install_github("mfherman/nycgeo")
```

<br>

## 1. Introduction

Long-term exposure to air pollutants can negatively impact health and increase rates of respiratory and cardiovascular diseases. Common [air pollutants](https://www.cdc.gov/air/pollutants.htm) include particulate matter, nitrogen oxides, and ozone. [Particulate matter (PM)](https://www.epa.gov/pm-pollution/particulate-matter-pm-basics#PM) is composed of very small particles of dust, dirt, or soot from construction or fires. Particles that are less than 2.5 micrometers (approximately 20 times smaller than width of a hair) are known as PM2.5. [Nitrogen oxides](https://www.epa.gov/no2-pollution/basic-information-about-no2#What%20is%20NO2), including nitrogen dioxide (NO~2~), are released when fuel (eg, oil, natural gas) is burned, such as emissions from vehicles. [Ozone](https://www.epa.gov/ground-level-ozone-pollution/ground-level-ozone-basics) is produced by a chemical reaction between nitrogen oxides and other volatile organic compounds in the presence of sunlight. As a result, ozone pollution tends to be worse in urban environments during the summer.

Because of the potential impacts and costs of air pollution, New York City tracks the level of common air pollutants across the city over time. Here, I analyze Anthony Conrardy's NYC air quality dataset to compare air pollutant levels versus time of year.

<br>

## 2. Data

### 2.1. Source

The dataset is from [NYC OpenData](https://opendata.cityofnewyork.us/), a publicly-available collection of datasets generated by New York City government projects. The [raw data](https://data.cityofnewyork.us/Environment/Air-Quality/c3uy-2p5r/data_preview) was available as a CSV file, so I downloaded and saved it to my GitHub repository.

### 2.2. Input

I read the CSV file into a dataframe (tibble). Due to the file size, only the first 100 rows are shown.

```{r read-raw-data}
nycaq_data_raw <- read_csv('https://media.githubusercontent.com/media/alexandersimon1/Data607/main/Project2/Dataset3/Air_Quality_20240226.csv', show_col_types = FALSE)
kbl_display(head(nycaq_data_raw, 100), "100%", "500px")
```

<br>

### 2.3. Dimensions

The data frame has 16,218 rows (measurements) and 12 columns (variables).

```{r df-dimensions}
dim(nycaq_data_raw)
```

<br>

## 3. Data checks and transformations

### 3.1. Understanding the column names

Some of the column names were confusing (eg, what is the difference between "Measure" and "Measure Info"?). To figure out what kind of data was in these columns, I examined the different categories of data in the column.

#### 3.1.1. "Measure Info" column

The "Measure Info" column appears to show the unit of each measurement value.

```{r data-categories-measure-info}
kbl_display(table(nycaq_data_raw$`Measure Info`), "50%")
```

<br>

To figure out what types of data had a unit of "number", I examined the rows that had this value. It appeared that only rows with a "Measure" of "Number per km2" have a "Measure Info" of "number."

```{r filter-number-unit}
kbl_display(
  nycaq_data_raw %>%
    filter(`Measure Info` == "number"),
  "100%", "500px")
```

<br>

#### 3.1.2. "Measure" column

The "Measure" column appeared to be a combination of units, which are redundant with the "Measure Info" column, and statistical descriptions (eg, average). This column does not seem necessary.

```{r data-categories-measure}
kbl_display(table(nycaq_data_raw$Measure), "50%")
```

<br>

#### 3.1.3. "Name" column

This column revealed a mixture of pollutant names (eg, NO2, ozone) and unrelated statistics, such as vehicle miles traveled, hospitalizations, and deaths.

```{r data-categories-name}
kbl_display(table(nycaq_data_raw$`Name`), "50%", "500px")
```

<br>

#### 3.1.4. "Time Period" column

This column shows the year(s) of the observation, either as a single number (eg, 2005) or as a range (eg, 2005-2007). Since there is also a "Start_Date" column, the year in the "Time Period" column may be redundant.

Some rows also include the season (summer or winter). The dataset does not appear to have data from spring or fall. It is not clear whether this is because no measurements were collected in spring and fall, or because each year is divided into 6-month intervals (ie, summer and winter).

```{r data-categories-time-period}
kbl_display(table(nycaq_data_raw$`Time Period`), "50%", "500px")
```

<br>

#### 3.1.5. "Start_Date" column

This column shows the start date of the "Time Period" column; however, examination of the month and days shows that there are only 3 different month values (1, 6, and 12). Presumably this corresponds to the start of the year (January) for the annual averages and June and December for the summer and winter seasons.

```{r data-categories-start-date-month}
nycaq_data_dates <- nycaq_data_raw %>%
  select(Start_Date) %>%
  mutate(
    Start_Date = as.Date(Start_Date, format = "%m/%d/%Y"),    
    Start_month = as.numeric(format(Start_Date, "%m")),
    Start_day = as.numeric(format(Start_Date, "%d"))    
  )
kbl_display(table(nycaq_data_dates$Start_month), "20%")
```

<br>

Similarly, there are only a few different values for the day. Moreover, nearly all the day values are 1, with relatively few values of 2 or 31, suggesting that they could be typos or due to data entry on days before or after holidays (eg, December 31, January 2nd).

```{r data-categories-start-date-day}
kbl_display(table(nycaq_data_dates$Start_day), "20%")
```

<br>

Together, this shows that the "Start_Date column" is mostly redundant with the "Time Period" column.

<br>

#### 3.1.6. "Geo Join ID" column

This column contains NYC neighborhood identifier codes. I explain how these IDs can be used to map the air pollutant data in Section [4.4. Chloropleth maps].

<br>

### 3.2. Select columns

Based on these explorations and the more easily understood column names, I selected the columns needed to perform exploratory data analysis and the analysis that Anthony proposed. I also renamed and reordered columns to make them more intuitive and easier to work with.

```{r select-columns}
nycaq_data <- nycaq_data_raw %>%
  select(
    ID = `Unique ID`,
    pollutant = Name,
    value = `Data Value`,
    unit = `Measure Info`,
    date = `Start_Date`,
    season = `Time Period`,
    geo_join_ID = `Geo Join ID`    
  )
```

<br>

### 3.3. Filter rows

Because this analysis focuses on air pollutants, I filtered the dataset for pollutants.

```{r filter-pollutant}
nycaq_data <- nycaq_data %>%
  filter(pollutant %in% c("Boiler Emissions- Total NOx Emissions",
                          "Boiler Emissions- Total PM2.5 Emissions",
                          "Boiler Emissions- Total SO2 Emissions",
                          "Fine particles (PM 2.5)",
                          "Nitrogen dioxide (NO2)",
                          "Outdoor Air Toxics - Benzene",
                          "Outdoor Air Toxics - Formaldehyde",
                          "Ozone (O3)"))
```

Note that this step eliminates the need to correct the rows with units of "number", because those rows are not associated with pollutants.

<br>

### 3.4. Data types

A glimpse of the data frame shows that the "date" column needs to be converted to date format. The data types of the other columns are appropriate.

```{r data-types}
glimpse(nycaq_data)
```

I also reformatted the date to only show the year. As noted previously, the month and day are not informative because there are only a few discrete values in the dataset.

```{r convert-date-format}
nycaq_data <- nycaq_data %>%
  mutate(
    date = as.Date(date, format = "%m/%d/%Y"),
    date = as.numeric(format(date, "%Y")),    
  ) %>%
  rename(year = date)
```

<br>

### 3.5. Duplicate rows

There were no duplicate rows.

```{r dup-rows}
sprintf("Total rows: %s", nrow(nycaq_data))
sprintf("Distinct rows: %s", nrow(distinct(nycaq_data)))
```

<br>

### 3.6. Missing values

There were no null (NA) values in any columns.

```{r check-na}
map(nycaq_data, ~ sum(is.na(.)))
```

<br>

### 3.7. Create data subsets

#### 3.7.1. Seasonal

This dataframe includes rows that have "Summer" or "Winter" in the season column. Because the year is already in the date column, I removed the year from the season column.

```{r filter-season}
nycaq_data_seasonal <- nycaq_data %>%
  filter(
    grepl("(Summer|Winter) \\d{4}", season),
  ) %>%
  mutate(
    season = str_extract(season, ".*(?= \\d{4})")
  )
```

Only 3 pollutants met these criteria.

```{r seasonal-pollutants}
kbl_display(table(nycaq_data_seasonal$pollutant), "30%")
```

I then created separate dataframes for each pollutant.

```{r create-seasonal-pollutant-df}
fine_particles_seasonal <- nycaq_data_seasonal %>%
  filter(pollutant == "Fine particles (PM 2.5)") %>%
  select(ID, PM2.5 = value, unit, year, season, geo_join_ID)

no2_seasonal <- nycaq_data_seasonal %>%
  filter(pollutant == "Nitrogen dioxide (NO2)") %>%
  select(ID, NO2 = value, unit, year, season, geo_join_ID)  

ozone_seasonal <- nycaq_data_seasonal %>%
  filter(pollutant == "Ozone (O3)") %>%
  select(ID, O3 = value, unit, year, season, geo_join_ID)  
```

<br>

#### 3.7.2. Annual averages

This dataframe includes rows that have "Annual Average" in the season column.

```{r create-annual-avg-df}
nycaq_data_annual_avg <- nycaq_data %>%
  filter(
    grepl("Annual Average \\d{4}", season),
  ) %>%
  # Season is not applicable
  select(ID, pollutant, value, unit, year, geo_join_ID)
```

Only 2 pollutants met these criteria.

```{r annual-pollutants}
kbl_display(table(nycaq_data_annual_avg$pollutant), "30%")
```

I then created separate dataframes for each pollutant.

```{r create-annual-pollutant-df}
fine_particles_annual <- nycaq_data_annual_avg %>%
  filter(pollutant == "Fine particles (PM 2.5)") %>%
  select(ID, PM2.5 = value, unit, year, geo_join_ID)

no2_annual <- nycaq_data_annual_avg %>%
  filter(pollutant == "Nitrogen dioxide (NO2)") %>%
  select(ID, NO2 = value, unit, year, geo_join_ID)
```

<br>

## 4. Analysis

### 4.1. Summary statistics

The data frame below summarizes the summary statistics of the 3 pollutants by season.

-   The mean concentration of fine particles (PM2.5) was similar in both summer (9.67 $µg/m^3$) and winter (9.80 $µg/m^3$); however, the spread (SD) is larger in the winter.

-   The mean (SD) concentration of nitrogen dioxide (NO~2~) was higher in the winter (25.79 [4.57] ppb) than in the summer (16.51 [5.43] ppb).

```{r summary-pollutant-season}
kbl_display(
  nycaq_data_seasonal %>%
    group_by(pollutant, season) %>%
    summarise(
      n = n(),
      min = min(value),
      max = max(value),
      mean = round(mean(value), 2),
      SD = round(sd(value), 2),
      median = median(value),
      IQR = IQR(value),
      .groups = "keep"
    ), "100%")
```

<br>

### 4.2. Distributions

#### 4.2.1. Fine particles (PM2.5)

The distribution of fine particle concentration during the summer and winter is similar. The winter distribution is a little more right-skewed than the summer distribution.

```{r histogram-pm2.5}
ggplot(fine_particles_seasonal, aes(x = PM2.5, fill = season)) +
  geom_histogram(binwidth = 0.15, alpha = 0.5, position = "identity") +
  scale_x_continuous(breaks = seq(6, 20, by = 2)) +
  xlab(bquote(bold("Concentration of fine particles (PM2.5) (µg/" * m^3 * ")"))) +
  ylab("Count") +
    theme(axis.title.y = element_text(face = "bold")) +    
  theme(
    axis.text = element_text(size = 10),
    axis.line = element_line(linewidth = 0.5, color = "darkgrey"))    
```

<br>

#### **4.2.2. Nitrogen dioxide (NO~2~)**

The distribution of nitrogen dioxide concentrations during the summer and winter are both bell-shaped, but the mean concentration is higher in the winter than in the summer.

```{r histogram-no2}
ggplot(no2_seasonal, aes(x = NO2, fill = season)) +
  geom_histogram(binwidth = 0.5, alpha = 0.5, position = "identity") +
  scale_x_continuous(breaks = seq(0, 50, by = 5)) +
  xlab(bquote(bold("Concentration of nitrogen dioxide (" * NO[2] * ") (ppb)"))) +
  ylab("Count") +
    theme(axis.title.y = element_text(face = "bold")) +
  theme(
    axis.text = element_text(size = 10),
    axis.line = element_line(linewidth = 0.5, color = "darkgrey"))
```

<br>

#### **4.2.3. Ozone (O~3~)**

The distribution of ozone concentrations during the summer is bell-shaped and skewed a little to the left.

```{r histogram-ozone}
ggplot(ozone_seasonal, aes(x = O3)) +
  geom_histogram(binwidth = 0.3, fill = "#F8766D", alpha = 0.5) +
  scale_x_continuous(breaks = seq(15, 40, by = 5)) +
  xlab(bquote(bold("Concentration of ozone (" * O[3] * ") (ppb)"))) +
  ylab("Count") +
    theme(axis.title.y = element_text(face = "bold")) +
  theme(
    axis.text = element_text(size = 10),
    axis.line = element_line(linewidth = 0.5, color = "darkgrey"))
```

<br>

### 4.3. Change over time

#### 4.3.1. Fine particles (PM2.5), annual

The average concentration[^1] of fine particles (PM2.5) trended downward from 2008 to 2020. During this time, levels decreased approximately two-fold.

[^1]: To be specific, the median of the annual averages, but this is a mouthful.

```{r average-PM2.5-over-time}
ggplot(fine_particles_annual, aes(x = factor(year), y = PM2.5, color = factor(year))) +
  geom_boxplot() +
  scale_y_continuous(breaks = seq(4, 18, by = 2)) +
  xlab("Year") +
    theme(axis.title.x = element_text(face = "bold")) +  
  ylab(bquote(bold("Concentration of fine particles (PM2.5) (µg/" * m^3 * ")"))) +  
  theme(
    axis.text = element_text(size = 10),
    axis.line = element_line(linewidth = 0.5, color = "darkgrey"),
    legend.position = "none")  
```

<br>

#### 4.3.2. Fine particles (PM2.5), seasonal

First, I reshaped the fine particles seasonal data to create side-by-side boxplots.

```{r reshape-PM2.5-seasonal-over-time}
temp_df <- fine_particles_seasonal %>%
  pivot_wider(
    id_cols = c(ID, year),
    names_from = season,
    values_from = PM2.5
  )

fine_particles_seasonal2 <- temp_df %>%
  pivot_longer(
    cols = c(Winter, Summer),
    names_to = "season",
    values_to = "PM2.5")
```

Then I removed the rows with null (NA) values.

```{r drop-na-4.3.2}
fine_particles_seasonal2 <- drop_na(fine_particles_seasonal2)
```

I omitted outliers from the boxplots to reduce clutter. The boxplots generally show that the average summer and winter concentrations of fine particulates decreased from 2010 to 2020. There was more year-to-year fluctuation in the winter levels than the summer levels before 2013 than after 2013.

There does not seem to be a pattern in the average concentration of fine particulates from season to season. The average concentration of some seasons is less than than the preceding season (eg, winter 2011 vs summer 2011), whereas the average concentration of other seasons is higher than the preceding season (eg, winter 2013 vs summer 2013). However, the season-to-season difference appears to become smaller over time.

```{r plot-PM2.5-seasonal-over-time, fig.width=8}
ggplot(fine_particles_seasonal2, 
       aes(x = factor(year), y = PM2.5, color = season, fill = season)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.2) +
  scale_y_continuous(breaks = seq(0, 20, by = 2)) +
  xlab("Year") +
    theme(axis.title.x = element_text(face = "bold")) +  
  ylab(bquote(bold("Concentration of fine particles (PM2.5) (µg/" * m^3 * ")"))) +  
  theme(
    axis.text = element_text(size = 10),
    axis.line = element_line(linewidth = 0.5, color = "darkgrey"))
```

<br>

#### 4.3.3. Nitrogen dioxide (NO~2~), annual

The average concentration of nitrogen dioxide has decreased from 2008 to 2021; however, there is wide variation in levels (ie, between the whiskers) as well as spikes (ie, high outlier values) each year.

```{r average-NO2-over-time}
ggplot(no2_annual, aes(x = factor(year), y = NO2, color = factor(year))) +
  geom_boxplot() +
  scale_y_continuous(breaks = seq(10, 50, by = 5)) +
  xlab("Year") +
    theme(axis.title.x = element_text(face = "bold")) +  
  ylab(bquote(bold("Concentration of nitrogen dioxide (" * NO[2] * ") (ppb)"))) +  
  theme(
    axis.text = element_text(size = 10),
    axis.line = element_line(linewidth = 0.5, color = "darkgrey"),
    legend.position = "none"
    )
```

<br>

#### 4.3.4. Nitrogen dioxide (NO~2~), seasonal

I reshaped the NO~2~ seasonal data to create side-by-side boxplots.

```{r reshape-NO2-seasonal-over-time}
temp_df <- no2_seasonal %>%
  pivot_wider(
    id_cols = c(ID, year),
    names_from = season,
    values_from = NO2
  )

no2_seasonal2 <- temp_df %>%
  pivot_longer(
    cols = c(Winter, Summer),
    names_to = "season",
    values_to = "NO2"
  )
```

Then I removed the rows with null (NA) values.

```{r drop-na-4.3.4}
no2_seasonal2 <- drop_na(no2_seasonal2)
```

I omitted outliers from the boxplots to reduce clutter. The boxplots show that the average concentration of nitrogen dioxide is higher in the winter than in the summer for all years in the dataset. In addition, the average summer levels have steadily decreased from 2009 to 2021. In contrast, the average winter levels remained relatively unchanged during this period.

Across all years, the average concentration of NO~2~ alternates from being low in the summer to high in the winter. This pattern is consistent with the fact that NO~2~ is produced from burning fuel since more fuel is used in the winter for heating.

```{r plot-NO2-seasonal-over-time, fig.width=8}
ggplot(no2_seasonal2, 
       aes(x = factor(year), y = NO2, color = season, fill = season)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.2) +
  xlab("Year") +
    theme(axis.title.x = element_text(face = "bold")) +  
  ylab(bquote(bold("Concentration of nitrogen dioxide (" * NO[2] * ") (ppb)"))) + 
  theme(
    axis.text = element_text(size = 10),
    axis.line = element_line(linewidth = 0.5, color = "darkgrey")
    )
```

<br>

### 4.4. Chloropleth maps

#### 4.4.1. Understanding "Geo Join ID"

Since the raw dataset included names and geographic IDs of NYC neighborhoods, I wanted to see if I could map the air pollutant data to a map. I've never done this before and found it challenging to figure out. This was complicated by the fact that the NYC Open Data [website](https://data.cityofnewyork.us/Environment/Air-Quality/c3uy-2p5r/about_data) for the air pollutant data only vaguely describes "Geo Join ID" as "an identifier to join to mapping geography files to make thematic maps". As a beginner, I didn't know what that meant. Moreover, a Google search for the term "Geo Join ID" did not yield any useful results. However, after extensive research about how maps can be created in R,[^2] I figured out that "Geo Join ID" corresponds to NYC borough ID codes that are used to define geographic boundaries in the `nycgeo` R package.

[^2]: Key websites that helped me create chloropleth maps of the air pollutant data:

    <https://justinmorganwilliams.medium.com/basics-of-gis-mapping-with-r-using-grow-nyc-markets-75adcdd9b0>

    <https://rdvark.net/2021/12/29/pretty-choropleth-maps-with-sf-and-ggplot2/>

With this key insight, I was able to create "chloropleth" maps of the air pollutant data. A [chloropleth map](https://en.wikipedia.org/wiki/Choropleth_map) is a type of thematic map that uses color scales to depict differences in data values across geographic areas. Now the explanation of "Geo Join ID" on the NYC Open Data website makes sense!

<br>

#### 4.4.2. Tidy "Geo Join ID"

Geo Join IDs are 3-digit identifiers; however, some values in the air pollutant dataset have 6 or 9 digits and appear to be concatenations of multiple identifiers. Since I don't know which is the correct identifier, I omitted all rows with Geo Join IDs with more or less than 3 digits (implemented in next section).

<br>

#### 4.4.3. Data subsets

Due to the nature of a map and the color mapping, a chloropleth map is only a snapshot in time. To test its application to the air pollutant data, I created two subsets of the seasonal nitrogen dioxide data, one with data from summer 2009 and the other with data from summer 2020. The boxplots in section 4.3.4 showed that the median concentration of NO~2~ across the entire city was lower in the summer of 2020 than in the summer of 2009; however, the plot doesn't show changes at the neighborhood level.

```{r subset-no2-summer2009}
no2_summer2009 <- no2_seasonal %>%
  filter(year == 2009 & season == "Summer" & (geo_join_ID >= 100 & geo_join_ID < 1000))
```

```{r subset-no2-summer2020}
no2_summer2020 <- no2_seasonal %>%
  filter(year == 2020 & season == "Summer" & (geo_join_ID >= 100 & geo_join_ID < 1000))
```

<br>

#### 4.4.4. Creating the maps

First, I used functions from the `nycgeo` and `sf` libraries to import the geographic boundaries of NYC community districts and transform them to the New York coordinate reference system ([crs 2263](https://epsg.io/2263)).[^3]

[^3]: The code block produces a message that the coordinate reference system object is outdated. I found a Stack Overflow [webpage](https://stackoverflow.com/questions/72609297/r-map-with-eurostat-package) that explains the issue, but as far as I can tell, it is due to how the coordinate reference system was generated. Since this is an external resource, I don't know how to update it. In any case, the code seems to work fine as is.

```{r create-nyc-geography-df, message = FALSE}
nyc_cd <- nyc_boundaries(
  geography = 'cd',
) %>%
  st_transform(2263)
```

Then I combined the NYC boundaries dataframe with the air pollutants dataframe using the common borough ID in the former and the Geo Join ID in the latter.

```{r join-boundaries-pollutant-data}
# IDs have different data types in the 2 dataframes
nyc_cd <- nyc_cd %>%
  mutate(
    borough_cd_id = as.numeric(borough_cd_id)
  )
# Join the dataframes
nyc_cd_comb_no2_summer2009 <- nyc_cd %>%
  left_join(no2_summer2009, by = c("borough_cd_id" = "geo_join_ID"))

nyc_cd_comb_no2_summer2020 <- nyc_cd %>%
  left_join(no2_summer2020, by = c("borough_cd_id" = "geo_join_ID"))
```

In summer 2009, NO~2~ levels were highest in the Midtown area and lowest along the Long Beach Barrier Island and around Howard Beach (Queens). Note that areas without any data are shown as gray.

```{r chloro-map-no2-summer2009}
ggplot(nyc_cd_comb_no2_summer2009, aes(fill = NO2)) +
  geom_sf(color = NA) +
  scale_fill_distiller(palette = "RdBu", direction = -1) +  
  theme_void() +
  ggtitle(bquote(bold(NO[2] * " levels in NYC neighborhoods in summer 2009")))
```

In summer 2020, NO~2~ levels were highest around Carroll Gardens (Brooklyn) and lowest along the Long Beach Barrier Island and around Howard Beach.

Comparing the two maps shows that NO~2~ levels in the Midtown area decreased substantially from 2009 to 2020. On the other hand, there was not much change on the Long Beach Barrier Island, Staten Island, and most of Queens. However, NO~2~ levels in these areas were already relatively low in 2009. These differences are consistent with the greater urban density in Manhattan versus less urban areas of NYC since traffic and population density would be expected to be proportional to the amount of fuel burned, which is the primary source of NO~2~.

```{r chloro-map-no2-summer2020}
ggplot(nyc_cd_comb_no2_summer2020, aes(fill = NO2)) +
  geom_sf(color = NA) +
  scale_fill_distiller(palette = "RdBu", direction = -1) +  
  theme_void() +
  ggtitle(bquote(bold(NO[2] * " levels in NYC neighborhoods in summer 2020")))
```

<br>

### 5. Conclusions

I cleaned and analyzed the NYC air quality dataset. I did my best to analyze Anthony's proposal to compare air pollutant levels versus time of year. However, the data were not as granular as I expected and many pollutants did not have seasonal data, which limited the comparisons that could be performed.

My analyses showed that PM2.5 and NO~2~ levels in NYC have decreased during the time frame of the dataset. The seasonal pattern of pollutant levels was clearest for NO~2~, which showed a clear difference between summer and winter that is consistent with the greater amount of fuel that is burned during the winter.

I also created chloropleth maps to compare NO~2~ levels in NYC neighborhoods in 2009 versus 2020. The maps showed that the city-wide decrease from 2009 to 2020 was mainly driven by decreases in Manhattan. This could be due to changes in traffic volume, vehicle fuel efficiency, and/or residential heating needs.

Chloropleth maps are visually appealing; however, because each map only represents data from a specific time point, many maps would need to be created to analyze changes over time. It may be possible to show this using an animation, which may be a future project.
